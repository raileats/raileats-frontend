
import React, { useState } from 'react';
export default function LoginModal({show,onClose,onSuccess,apiBase}){ const [step,setStep]=useState('phone'); const [name,setName]=useState(''); const [phone,setPhone]=useState(''); const [otp,setOtp]=useState('');
if(!show) return null;
const send = async ()=>{ const res = await fetch((apiBase||'') + '/api/auth/send-otp',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name,phone})}); const data = await res.json(); if(data.ok){ alert('OTP sent (demo: 123456)'); setStep('otp'); } else alert('error'); };
const verify = async ()=>{ const res = await fetch((apiBase||'') + '/api/auth/verify-otp',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name,phone,otp})}); const data = await res.json(); if(data.ok){ onSuccess(data.user, data.token); } else alert(data.error||'error'); };
return (<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,.5)',display:'flex',alignItems:'center',justifyContent:'center'}} onClick={onClose}><div style={{background:'#fff',padding:16,borderRadius:8,width:340}} onClick={e=>e.stopPropagation()}><h3>Customer Login</h3>{step==='phone'? (<div><input placeholder='Your name' value={name} onChange={e=>setName(e.target.value)} style={{width:'100%',padding:8,marginBottom:8}}/><input placeholder='Mobile' value={phone} onChange={e=>setPhone(e.target.value)} style={{width:'100%',padding:8,marginBottom:8}}/><div style={{display:'flex',gap:8}}><button onClick={send} className='btn'>Send OTP</button><button onClick={onClose} className='btn btn-outline'>Cancel</button></div></div>) : (<div><input placeholder='Enter OTP (123456)' value={otp} onChange={e=>setOtp(e.target.value)} style={{width:'100%',padding:8,marginBottom:8}}/><div style={{display:'flex',gap:8}}><button onClick={verify} className='btn'>Verify</button><button onClick={()=>setStep('phone')} className='btn btn-outline'>Back</button></div></div>)}</div></div>); }
